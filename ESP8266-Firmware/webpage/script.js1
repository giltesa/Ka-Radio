var content="Content-type",ctype="application/x-www-form-urlencoded",cjson="application/json";var intervalid,timeid,websocket,urlmonitor,e,playing=false,curtab="tab-content1",stchanged=false,maxStation=255;const karadio="Karadio";function openwebsocket(){websocket=new WebSocket("ws://"+window.location.host+"/");console.log("url:ws://"+window.location.host+"/");websocket.onmessage=function(b){try{var a=JSON.parse(b.data);console.log("onmessage:"+b.data);if(a.meta==""){document.getElementById("meta").innerHTML=karadio;setMainHeight(curtab)}if(a.meta){document.getElementById("meta").innerHTML=a.meta.replace(/\\/g,"");setMainHeight(curtab)}if(a.wsvol){onRangeVolChange(a.wsvol,false)}if(a.wsicy){icyResp(a.wsicy)}if(a.wssound){soundResp(a.wssound)}if(a.monitor){playMonitor(a.monitor)}if(a.wsstation){wsplayStation(a.wsstation)}}catch(c){console.log("error"+c)}};websocket.onopen=function(a){console.log("Open, url:ws://"+window.location.host+"/");if(window.timerID){window.clearInterval(window.timerID);window.timerID=0}refresh()};websocket.onclose=function(a){console.log("onclose code: "+a.code);console.log("onclose reason: "+a.reason);if(!window.timerID){window.timerID=setInterval(function(){checkwebsocket()},2000)}};websocket.onerror=function(a){console.log("onerror reason: "+a.reason);websocket.close()}}function wsplayStation(a){var b;select=document.getElementById("stationsSelect");opt=select.options;for(b=0;b<maxStation;b++){id=opt[b].value.split(":");id=id[0];if(id==a){break}}if(b==maxStation){b=0}select.selectedIndex=b}function playMonitor(a){urlmonitor="";urlmonitor=a;if(playing){monitor=document.getElementById("audio");if(urlmonitor.endsWith("/")){var b=urlmonitor+";"}else{b=urlmonitor}monitor.src=b;monitor.play()}}function mplay(){monitor=document.getElementById("audio");if(urlmonitor.endsWith("/")){var a=urlmonitor+";"}else{a=urlmonitor}monitor.src=a;monitor.volume=document.getElementById("volm_range").value/100;while(monitor.networkState==2){}monitor.play();playing=true;monitor.muted=false}function monerror(){monitor=document.getElementById("audio");console.log("monitor error1 "+monitor.error.code)}function mstop(){monitor=document.getElementById("audio");monitor.muted=true;monitor.src="http://karadio.karawin.fr/silence-1sec.mp3";playing=false}function mpause(){monitor=document.getElementById("audio");monitor.pause()}function mvol(a){monitor=document.getElementById("audio");monitor.volume=a}function checkwebsocket(){if(typeof websocket=="undefined"){openwebsocket()}else{if(websocket.readyState==websocket.CLOSED){openwebsocket()}else{if(websocket.readyState==websocket.OPEN){websocket.send("opencheck")}}}}function chkip(a){if(/^([0-9]+\.){3}[0-9]+$/.test(a.value)){a.style.color="green"}else{a.style.color="red"}}function clickdhcp(){if(document.getElementById("dhcp").checked){document.getElementById("ip").setAttribute("disabled","");document.getElementById("mask").setAttribute("disabled","");document.getElementById("gw").setAttribute("disabled","")}else{document.getElementById("ip").removeAttribute("disabled");document.getElementById("mask").removeAttribute("disabled");document.getElementById("gw").removeAttribute("disabled")}}function valid(){wifi(1);alert("System reboot. Please change your browser address to the new one.")}function dtime(){var c=new Date(),a=document.getElementById("sminutes"),b=document.getElementById("wminutes");document.getElementById("time").innerHTML=c.toLocaleTimeString();if((!isNaN(a.innerHTML))&&(a.innerHTML!="0")){--a.innerHTML}if((!isNaN(a.innerHTML))&&(a.innerHTML==0)){a.innerHTML="0"}if((!isNaN(b.innerHTML))&&(b.innerHTML!="0")){--b.innerHTML}if((!isNaN(b.innerHTML))&&(b.innerHTML==0)){b.innerHTML="0"}}function labelSleep(a){document.getElementById("sminutes").innerHTML=a}function sleepup(a){if(a.keyCode==13){startSleep()}}function startSleep(){var b,d,c;var f=new Date();var a=document.getElementById("sleepdelay").value.split(":");d=parseInt(a[0],10);c=parseInt(a[1],10);if(!isNaN(d)){if(!isNaN(c)){fut=new Date(f.getFullYear(),f.getMonth(),f.getDate(),d,c,0);if(fut.getTime()>f.getTime()){b=Math.round((fut.getTime()-f.getTime())/60000)}else{b=1440-Math.round((f.getTime()-fut.getTime())/60000)}if(b==0){if(fut.getTime()>f.getTime()){b=1}else{b=1440}}}else{b=d}websocket.send("startSleep="+b+"&");labelSleep("Started, Good night!");window.setTimeout(labelSleep,2000,(b*60)-2)}else{labelSleep("Error, try again");window.setTimeout(labelSleep,2000,"0")}}function stopSleep(){var b=document.getElementById("sleepdelay").value;websocket.send("stopSleep");labelSleep("0")}function labelWake(a){document.getElementById("wminutes").innerHTML=a}function wakeup(a){if(a.keyCode==13){startWake()}}function startWake(){var b,d,c;var f=new Date();var a=document.getElementById("wakedelay").value.split(":");d=parseInt(a[0],10);c=parseInt(a[1],10);if(!isNaN(d)){if(!isNaN(c)){fut=new Date(f.getFullYear(),f.getMonth(),f.getDate(),d,c,0);if(fut.getTime()>f.getTime()){b=Math.round((fut.getTime()-f.getTime())/60000)}else{b=1440-Math.round((f.getTime()-fut.getTime())/60000)}if(b==0){if(fut.getTime()>f.getTime()){b=1}else{b=1440}}}else{b=d}websocket.send("startWake="+b+"&");labelWake("Started");window.setTimeout(labelWake,2000,(b*60)-2)}else{labelWake("Error, try again");window.setTimeout(labelWake,2000,"0")}}function stopWake(){var b=document.getElementById("wakedelay").value;websocket.send("stopWake");labelWake("0")}function promptworking(a){document.getElementById("meta").innerHTML=a;if(a==""){document.getElementById("meta").innerHTML=karadio;refresh()}}function saveTextAsFile(){var b="",f,c,a,d;for(f=0;f<maxStation;f++){b=b+(localStorage[f])+"\n"}d=document.getElementById("filesave").value;if(d==""){alert("Please give a file name")}else{c=new Blob([b],{type:"text/plain"}),a=document.createElement("a");a.style.display="none";a.setAttribute("download",d);document.body.appendChild(a);if(window.navigator.msSaveOrOpenBlob){a.addEventListener("click",function(){window.navigator.msSaveBlob(c,d)})}else{if("URL" in window){a.href=window.URL.createObjectURL(c)}else{a.href=window.webkitURL.createObjectURL(c)}}a.click()}}function full(){if(document.getElementById("Full").checked){if((document.getElementById("not1").innerHTML=="")&&(document.getElementById("not1").innerHTML=="")){document.getElementById("lnot1").style.display="none"}else{document.getElementById("lnot1").style.display="inline-block"}if(document.getElementById("bitr").innerHTML==""){document.getElementById("lbitr").style.display="none"}else{document.getElementById("lbitr").style.display="inline-block"}if(document.getElementById("descr").innerHTML==""){document.getElementById("ldescr").style.display="none"}else{document.getElementById("ldescr").style.display="inline-block"}if(document.getElementById("genre").innerHTML==""){document.getElementById("lgenre").style.display="none"}else{document.getElementById("lgenre").style.display="inline-block"}}else{document.getElementById("lnot1").style.display="none";document.getElementById("lbitr").style.display="none";document.getElementById("ldescr").style.display="none";document.getElementById("lgenre").style.display="none"}setMainHeight("tab-content1")}function icyResp(a){if((a.descr=="")||(!document.getElementById("Full").checked)){document.getElementById("ldescr").style.display="none"}else{document.getElementById("ldescr").style.display="inline-block"}document.getElementById("descr").innerHTML=a.descr.replace(/\\/g,"");document.getElementById("name").innerHTML=a.name.replace(/\\/g,"");if((a.bitr=="")||(!document.getElementById("Full").checked)){document.getElementById("lbitr").style.display="none"}else{document.getElementById("lbitr").style.display="inline-block"}document.getElementById("bitr").innerHTML=a.bitr.replace(/\\/g,"")+" kB/s";if(a.bitr==""){document.getElementById("bitr").innerHTML=""}if(((a.not1=="")&&(a.not2==""))||(!document.getElementById("Full").checked)){document.getElementById("lnot1").style.display="none"}else{document.getElementById("lnot1").style.display="inline-block"}document.getElementById("not1").innerHTML=a.not1.replace(/\\/g,"").replace(/^<BR>/,"");document.getElementById("not2").innerHTML=a.not2.replace(/\\/g,"");if((a.genre=="")||(!document.getElementById("Full").checked)){document.getElementById("lgenre").style.display="none"}else{document.getElementById("lgenre").style.display="inline-block"}document.getElementById("genre").innerHTML=a.genre.replace(/\\/g,"");if(a.url1==""){document.getElementById("lurl").style.display="none";document.getElementById("icon").style.display="none"}else{document.getElementById("lurl").style.display="inline-block";document.getElementById("icon").style.display="inline-block";$url=a.url1.replace(/\\/g,"").replace(/ /g,"");if($url=="http://www.icecast.org/"){document.getElementById("icon").src="/logo.png"}else{document.getElementById("icon").src="http://www.google.com/s2/favicons?domain_url="+$url}}$url=a.url1.replace(/\\/g,"");document.getElementById("url1").innerHTML=$url;document.getElementById("url2").href=$url;if(a.meta==""){document.getElementById("meta").innerHTML=karadio;setMainHeight(curtab)}if(a.meta){document.getElementById("meta").innerHTML=a.meta.replace(/\\/g,"")}setMainHeight(curtab)}function soundResp(a){document.getElementById("vol_range").value=a.vol.replace(/\\/g,"");document.getElementById("treble_range").value=a.treb.replace(/\\/g,"");document.getElementById("bass_range").value=a.bass.replace(/\\/g,"");document.getElementById("treblefreq_range").value=a.tfreq.replace(/\\/g,"");document.getElementById("bassfreq_range").value=a.bfreq.replace(/\\/g,"");document.getElementById("spacial_range").value=a.spac.replace(/\\/g,"");onRangeVolChange(document.getElementById("vol_range").value,false);onRangeChange("treble_range","treble_span",1.5,false,true);onRangeChange("bass_range","bass_span",1,false,true);onRangeChangeFreqTreble("treblefreq_range","treblefreq_span",1,false,true);onRangeChangeFreqBass("bassfreq_range","bassfreq_span",10,false,true);onRangeChangeSpatial("spacial_range","spacial_span",true)}function refresh(){xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){try{var b=JSON.parse(xhr.responseText);icyResp(b);soundResp(b)}catch(c){console.log("error"+c)}}};try{websocket.send("monitor");xhr.open("POST","icy",false);xhr.setRequestHeader(content,cjson);xhr.send()}catch(a){console.log("error"+a)}}function theme(){websocket.send("theme");window.location.reload(true)}function resetEQ(){document.getElementById("treble_range").value=0;onRangeChange("treble_range","treble_span",1.5,false);document.getElementById("bass_range").value=0;onRangeChange("bass_range","bass_span",1,false);document.getElementById("treblefreq_range").value=1;onRangeChangeFreqTreble("treblefreq_range","treblefreq_span",1,false);document.getElementById("bassfreq_range").value=2;onRangeChangeFreqBass("bassfreq_range","bassfreq_span",10,false);document.getElementById("spacial_range").value=0;onRangeChangeSpatial("spacial_range","spacial_span")}function onRangeChange(g,c,f,b,a){var d=document.getElementById(g).value;if(b){d=document.getElementById(g).max-d}document.getElementById(c).innerHTML=(d*f)+" dB";if(typeof(a)=="undefined"){saveSoundSettings()}}function onRangeChangeFreqTreble(g,c,f,b,a){var d=document.getElementById(g).value;if(b){d=document.getElementById(g).max-d}document.getElementById(c).innerHTML="From "+(d*f)+" kHz";if(typeof(a)=="undefined"){saveSoundSettings()}}function onRangeChangeFreqBass(g,c,f,b,a){var d=document.getElementById(g).value;if(b){d=document.getElementById(g).max-d}document.getElementById(c).innerHTML="Under "+(d*f)+" Hz";if(typeof(a)=="undefined"){saveSoundSettings()}}function onRangeChangeSpatial(f,c,b){var d=document.getElementById(f).value,a;switch(d){case"0":a="Off";break;case"1":a="Minimal";break;case"2":a="Normal";break;case"3":a="Maximal";break}document.getElementById(c).innerHTML=a;if(typeof(b)=="undefined"){saveSoundSettings()}}function logValue(b){var a=Number(b)+1;var c=Math.round((Math.log10(255/a)*105.54571334));return c}function onRangeVolChange(b,a){var c=logValue(b);document.getElementById("vol1_span").innerHTML=(c*-0.5)+" dB";document.getElementById("vol_span").innerHTML=(c*-0.5)+" dB";document.getElementById("vol_range").value=b;document.getElementById("vol1_range").value=b;if(a&&websocket.readyState==websocket.OPEN){websocket.send("wsvol="+b+"&")}}function wifi(a){xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){var b=JSON.parse(xhr.responseText);document.getElementById("ssid").value=b.ssid;document.getElementById("passwd").value=b.pasw;document.getElementById("ssid2").value=b.ssid2;document.getElementById("passwd2").value=b.pasw2;document.getElementById("ip").value=b.ip;chkip(document.getElementById("ip"));document.getElementById("mask").value=b.msk;chkip(document.getElementById("mask"));document.getElementById("gw").value=b.gw;chkip(document.getElementById("gw"));document.getElementById("ua").value=b.ua;if(b.dhcp=="1"){document.getElementById("dhcp").setAttribute("checked","")}else{document.getElementById("dhcp").removeAttribute("checked")}clickdhcp()}};xhr.open("POST","wifi",false);xhr.setRequestHeader(content,ctype);xhr.send("valid="+a+"&ssid="+document.getElementById("ssid").value+"&pasw="+document.getElementById("passwd").value+"&ssid2="+document.getElementById("ssid2").value+"&pasw2="+document.getElementById("passwd2").value+"&ip="+document.getElementById("ip").value+"&msk="+document.getElementById("mask").value+"&gw="+document.getElementById("gw").value+"&ua="+document.getElementById("ua").value+"&dhcp="+document.getElementById("dhcp").checked+"&")}function instantPlay(){var a;try{xhr=new XMLHttpRequest();xhr.open("POST","instant_play",false);xhr.setRequestHeader(content,ctype);a=document.getElementById("instant_path").value;if(!(a.substring(0,1)==="/")){a="/"+a}document.getElementById("instant_url").value=document.getElementById("instant_url").value.replace(/^https?:\/\//,"");a=fixedEncodeURIComponent(a);xhr.send("url="+document.getElementById("instant_url").value+"&port="+document.getElementById("instant_port").value+"&path="+a+"&")}catch(b){console.log("error"+b)}}function prevStation(){var a=document.getElementById("stationsSelect").selectedIndex;if(a>0){document.getElementById("stationsSelect").selectedIndex=a-1;Select()}}function nextStation(){var a=document.getElementById("stationsSelect").selectedIndex;if(a<document.getElementById("stationsSelect").length-1){document.getElementById("stationsSelect").selectedIndex=a+1;Select()}}function autoplay(){try{xhr.open("POST","auto",false);xhr.setRequestHeader(content,ctype);xhr.send("id="+document.getElementById("aplay").checked+"&")}catch(a){console.log("error"+a)}}function Select(){if(document.getElementById("aplay").checked){playStation()}}function playStation(){var a,c;try{mpause();a=document.getElementById("stationsSelect");c=a.options[a.selectedIndex].value.split(":");c=c[0];localStorage.setItem("selindexstore",a.selectedIndex.toString());xhr=new XMLHttpRequest();xhr.open("POST","play",false);xhr.setRequestHeader(content,ctype);xhr.send("id="+c+"&")}catch(b){console.log("error"+b)}}function stopStation(){var a=document.getElementById("stationsSelect");mstop();localStorage.setItem("selindexstore",a.options.selectedIndex.toString());try{xhr=new XMLHttpRequest();xhr.open("POST","stop",false);xhr.setRequestHeader(content,ctype);xhr.send()}catch(b){console.log("error"+b)}}function saveSoundSettings(){xhr=new XMLHttpRequest();xhr.open("POST","sound",false);xhr.setRequestHeader(content,ctype);xhr.send("&bass="+document.getElementById("bass_range").value+"&treble="+document.getElementById("treble_range").value+"&bassfreq="+document.getElementById("bassfreq_range").value+"&treblefreq="+document.getElementById("treblefreq_range").value+"&spacial="+document.getElementById("spacial_range").value+"&")}function fixedEncodeURIComponent(a){return a.replace(/[&]/g,function(b){return"%"+b.charCodeAt(0).toString(16)})}function saveStation(){var c=document.getElementById("add_path").value,b=document.getElementById("add_url").value,a;if(!(c.substring(0,1)==="/")){c="/"+c}console.log("Path: "+c);a=fixedEncodeURIComponent(c);console.log("JSON: "+a);b=b.replace(/^https?:\/\//,"");try{xhr=new XMLHttpRequest();xhr.open("POST","setStation",false);xhr.setRequestHeader(content,ctype);xhr.send("nb="+1+"&id="+document.getElementById("add_slot").value+"&url="+b+"&name="+document.getElementById("add_name").value+"&file="+a+"&ovol="+document.getElementById("ovol").value+"&port="+document.getElementById("add_port").value+"&&");localStorage.setItem(document.getElementById("add_slot").value,'{"Name":"'+document.getElementById("add_name").value+'","URL":"'+b+'","File":"'+c+'","Port":"'+document.getElementById("add_port").value+'","ovol":"'+document.getElementById("ovol").value+'"}')}catch(d){console.log("error save "+d)}abortStation();loadStations();loadStationsList(maxStation)}function abortStation(){document.getElementById("editStationDiv").style.display="none";setMainHeight("tab-content2")}function editStation(d){var a;function c(f){document.getElementById("add_url").value=f.URL;document.getElementById("add_name").value=f.Name;document.getElementById("add_path").value=f.File;if(f.Port=="0"){f.Port="80"}document.getElementById("add_port").value=f.Port;document.getElementById("editStationDiv").style.display="block";document.getElementById("ovol").value=f.ovol;setMainHeight("tab-content2")}document.getElementById("add_slot").value=d;idstr=d.toString();if(localStorage.getItem(idstr)!=null){try{a=JSON.parse(localStorage.getItem(idstr))}catch(b){console.log("error"+b)}c(a)}else{xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){try{a=JSON.parse(xhr.responseText)}catch(f){console.log("error"+f)}c(a)}};xhr.open("POST","getStation",false);xhr.setRequestHeader(content,ctype);xhr.send("idgp="+d+"&")}}function refreshList(){promptworking("Working.. Please Wait");intervalid=window.setTimeout(refreshListtemp,2)}function refreshListtemp(){if(stchanged){stChanged()}localStorage.clear();loadStationsList(maxStation);loadStations();promptworking("");refresh()}function clearList(){promptworking("Working.. Please Wait");if(confirm("Warning: This will clear all stations.\n Be sure to save station before.\nClear now?")){xhr=new XMLHttpRequest();xhr.open("POST","clear",false);xhr.setRequestHeader(content,ctype);xhr.send();refreshList();window.setTimeout(loadStations,5)}else{promptworking("")}}function upgrade(){if(websocket.readyState==websocket.OPEN){websocket.send("upgrade")}alert("Rebooting to the new release\nPlease refresh the page in few seconds.")}function checkhistory(){if(window.XDomainRequest){xhr=new XDomainRequest()}else{if(window.XMLHttpRequest){xhr=new XMLHttpRequest()}}xhr.onload=function(){document.getElementById("History").innerHTML=xhr.responseText};xhr.open("GET","http://KaraDio.karawin.fr/history.php",false);try{xhr.send(null)}catch(a){}}function checkversion(){if(window.XDomainRequest){xhr=new XDomainRequest()}else{if(window.XMLHttpRequest){xhr=new XMLHttpRequest()}}xhr.onload=function(){document.getElementById("Version").innerHTML=xhr.responseText};xhr.open("GET","http://KaraDio.karawin.fr/version.php",false);try{xhr.send(null)}catch(a){}checkhistory()}function downloadStations(){var h,g,j,b,a,d,c,f;if(window.File&&window.FileReader&&window.FileList&&window.Blob){a=new FileReader();xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){promptworking("Working.. Please Wait")};a.onload=function(k){function i(m,l){if(!l.ovol){l.ovol="0"}j=j+"&id="+m+"&url="+l.URL+"&name="+l.Name+"&file="+l.File+"&port="+l.Port+"&";localStorage.setItem(m,'{"Name":"'+l.Name+'","URL":"'+l.URL+'","File":"'+l.File+'","Port":"'+l.Port+'","ovol":"'+l.ovol+'"}')}d=this.result.split("\n");localStorage.clear();g=7;c=0;try{j="nb="+g;for(h=0;h<g;h++){b=JSON.parse(d[h]);i(h,b)}xhr.open("POST","setStation",false);xhr.setRequestHeader(content,ctype);console.log("post "+j);xhr.send(j)}catch(k){console.log("error "+k)}g=8;for(c=7;c<d.length;c+=g){try{j="nb="+g;for(h=0;h<g;h++){b=JSON.parse(d[c+h]);i(c+h,b)}xhr.open("POST","setStation",false);xhr.setRequestHeader(content,ctype);xhr.send(j)}catch(k){console.log("error "+k)}}loadStationsList(maxStation)};f=document.getElementById("fileload").files[0];if(f==null){alert("Please select a file")}else{promptworking("Working.. Please Wait");a.readAsText(f)}}}function dragStart(a){a.dataTransfer.setData("Text",a.target.id)}function moveNodes(f,d){var h=f.parentNode,g=d.nextSibling,c;if(g===f){g=g.nextSibling}h.insertBefore(f,d);c=0;for(c=0;c<maxStation;c++){h.rows[c].cells[0].innerText=c.toString();h.rows[c].cells[6].innerHTML=d.parentNode.rows[c].cells[6].innerHTML}stchanged=true;document.getElementById("stsave").disabled=false}function dragDrop(b){b.preventDefault();var c=document.getElementById(b.dataTransfer.getData("text"));var a=document.getElementById(b.currentTarget.id);moveNodes(c,a)}function allowDrop(a){a.preventDefault()}function stChanged(){var f,d,h,c,b=document.getElementById("stationsTable").getElementsByTagName("tbody")[0];function a(i){id=b.rows[i].cells[0].innerText;name=b.rows[i].cells[1].innerText;url=b.rows[i].cells[2].innerText;file=b.rows[i].cells[3].innerText;port=b.rows[i].cells[4].innerText;ovol=b.rows[i].cells[5].innerText;localStorage.setItem(id,'{"Name":"'+name+'","URL":"'+url+'","File":"'+file+'","Port":"'+port+'","ovol":"'+ovol+'"}');h=h+"&id="+id+"&url="+url+"&name="+name+"&file="+file+"&port="+port+"&ovol="+ovol+"&"}promptworking("Working.. Please Wait");if(stchanged&&confirm("The list is modified. Do you want to save the modified list?")){xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){};promptworking("Working.. Please Wait");localStorage.clear();d=7;c=0;try{h="nb="+d;for(f=0;f<d;f++){a(c+f)}xhr.open("POST","setStation",false);xhr.setRequestHeader(content,ctype);xhr.send(h)}catch(g){console.log("error "+g)}d=8;for(c=7;c<maxStation;c+=d){try{h="nb="+d;for(f=0;f<d;f++){a(c+f)}xhr.open("POST","setStation",false);xhr.setRequestHeader(content,ctype);xhr.send(h)}catch(g){console.log("error "+g)}}loadStationsList(maxStation)}stchanged=false;document.getElementById("stsave").disabled=true;promptworking("");setMainHeight(curtab)}function loadStations(){var a=document.createElement("tbody"),d=0;function b(g,f){tr=document.createElement("TR"),td=document.createElement("TD");tr.draggable="true";tr.id="tr"+g.toString();tr.ondragstart=dragStart;tr.ondrop=dragDrop;tr.ondragover=allowDrop;td.appendChild(document.createTextNode(g));tr.appendChild(td);for(key in f){td=document.createElement("TD");td.style="word-break: break-all;overflow-wrap: break-word; word-wrap: break-word;";if(f[key].length>116){f[key]="Error"}td.appendChild(document.createTextNode(f[key]));tr.appendChild(td)}td=document.createElement("TD");td.innerHTML='<a href="#" onClick="editStation('+g+')">Edit</a>';tr.appendChild(td);a.appendChild(tr)}for(d;d<maxStation;d++){idstr=d.toString();if(localStorage.getItem(idstr)!=null){try{arr=JSON.parse(localStorage.getItem(idstr))}catch(c){console.log("error"+c)}b(d,arr)}else{try{xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){try{arr=JSON.parse(xhr.responseText)}catch(f){console.log("error"+f)}localStorage.setItem(idstr,xhr.responseText);b(d,arr)}};xhr.open("POST","getStation",false);xhr.setRequestHeader(content,ctype);xhr.send("idgp="+d+"&")}catch(c){console.log("error"+c);d--}}}old_tbody=document.getElementById("stationsTable").getElementsByTagName("tbody")[0];old_tbody.parentNode.replaceChild(a,old_tbody);setMainHeight("tab-content2")}function loadStationsList(k){var j=false,b,c,g,l,f=[],d;l=document.getElementById("stationsSelect");for(d=l.options.length-1;d>=0;d--){l.remove(d)}function a(m,i){j=false;if(i.Name.length>0){c=document.createElement("option");c.appendChild(document.createTextNode(m+": \t"+i.Name));l.add(c)}else{j=true}return j}l.disabled=true;promptworking("Working.. Please Wait");for(b=0;b<k;b++){idstr=b.toString();if(localStorage.getItem(idstr)!=null){try{g=JSON.parse(localStorage.getItem(idstr))}catch(h){console.log("error"+h)}j=a(b,g)}else{try{xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.readyState==4&&xhr.status==200){try{g=JSON.parse(xhr.responseText)}catch(i){console.log("error"+i)}localStorage.setItem(idstr,xhr.responseText);j=a(b,g)}};xhr.open("POST","getStation",false);xhr.setRequestHeader(content,ctype);xhr.send("idgp="+b+"&")}catch(h){console.log("error"+h);b--}}}promptworking("");l.disabled=false;l.options.selectedIndex=parseInt(localStorage.getItem("selindexstore"))}function setMainHeight(a){var c=window.innerHeight,b=document.getElementById(a).scrollHeight+200;if(b<c){b=c}document.getElementById("MAIN").style.height=b+"px"}document.addEventListener("DOMContentLoaded",function(){document.getElementById("tab1").addEventListener("click",function(){if(stchanged){stChanged()}refresh();curtab="tab-content1";setMainHeight(curtab)});document.getElementById("tab2").addEventListener("click",function(){if(stchanged){stChanged()}loadStations();curtab="tab-content2";intervalid=window.setTimeout(setMainHeight,1,curtab)});document.getElementById("tab3").addEventListener("click",function(){if(stchanged){stChanged()}curtab="tab-content3";wifi(0);checkversion();setMainHeight(curtab)});if(intervalid!=0){window.clearTimeout(intervalid)}intervalid=0;if(timeid!=0){window.clearInterval(timeid)}timeid=window.setInterval(dtime,1000);loadStationsList(maxStation);checkwebsocket();refresh();wifi(0);checkversion();setMainHeight(curtab);promptworking("")});